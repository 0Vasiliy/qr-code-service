import{D as $,r as m,d as E,E as P,j as x,v as u,x as c,y as e,F as S,n as k,C as _,z as i,G as h,H as C,I as w,J as g}from"./vGEm8TUM.js";const T=$("auth",()=>{const d=m(null),n=m(!1),a=m(!1),o=m(null);return{user:d,isAuthenticated:n,loading:a,error:o,login:async(t,s)=>{a.value=!0,o.value=null;try{const l=await(await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:s})})).json();if(!l.success)throw new Error(l.error||"Invalid email or password");return d.value=l.user,n.value=!0,l.user}catch(r){throw o.value=r instanceof Error?r.message:"Login failed",r}finally{a.value=!1}},register:async(t,s,r)=>{a.value=!0,o.value=null;try{const f=await(await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:s,password:r})})).json();if(!f.success)throw new Error(f.error||"Registration failed");return d.value=f.user,n.value=!0,f.user}catch(l){throw o.value=l instanceof Error?l.message:"Registration failed",l}finally{a.value=!1}},logout:async()=>{try{const s=await(await fetch("/api/auth/logout",{method:"POST"})).json();if(s.success)d.value=null,n.value=!1;else throw new Error(s.error)}catch(t){throw console.error("Logout error:",t),t}},sendVerificationEmail:async()=>{try{const s=await(await fetch("/api/auth/verify-email",{method:"POST"})).json();if(!s.success)throw new Error(s.error)}catch(t){throw console.error("Verification email error:",t),t}}}}),V={class:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8"},j={class:"absolute top-4 left-4"},A={class:"sm:mx-auto sm:w-full sm:max-w-md"},O={class:"mt-6 text-center text-3xl font-extrabold text-gray-900"},B={class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},H={class:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10"},M={key:0,class:"mb-4 p-4 bg-red-50 text-red-700 rounded-md"},N={key:0},q={for:"name",class:"block text-sm font-medium text-gray-700"},z={class:"mt-1"},L={for:"email",class:"block text-sm font-medium text-gray-700"},U={class:"mt-1"},D={for:"password",class:"block text-sm font-medium text-gray-700"},J={class:"mt-1"},I={key:1},R={for:"confirmPassword",class:"block text-sm font-medium text-gray-700"},F={class:"mt-1"},G=["disabled"],K={key:0,class:"mr-2"},Q={class:"mt-6 text-center"},X=E({__name:"auth",setup(d){const n=T(),a=m(!0),o=P({name:"",email:"",password:"",confirmPassword:""}),p=x(()=>n.loading),v=x(()=>n.error),y=()=>{a.value=!a.value},b=async()=>{try{if(a.value)await n.login(o.email,o.password);else{if(o.password!==o.confirmPassword)throw new Error("Passwords do not match");await n.register(o.email,o.password,o.name)}k("/dashboard")}catch(t){console.error("Auth error:",t)}};return(t,s)=>(c(),u("div",V,[e("div",j,[e("button",{onClick:s[0]||(s[0]=r=>("navigateTo"in t?t.navigateTo:S(k))("/")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500"},[s[5]||(s[5]=e("svg",{class:"h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1)),_(" "+i(t.$t("auth.back")),1)])]),e("div",A,[e("h2",O,i(a.value?t.$t("auth.login"):t.$t("auth.register")),1)]),e("div",B,[e("div",H,[v.value?(c(),u("div",M,i(v.value),1)):h("",!0),e("form",{class:"space-y-6",onSubmit:C(b,["prevent"])},[a.value?h("",!0):(c(),u("div",N,[e("label",q,i(t.$t("auth.name")),1),e("div",z,[w(e("input",{id:"name","onUpdate:modelValue":s[1]||(s[1]=r=>o.name=r),type:"text",required:"",class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm"},null,512),[[g,o.name]])])])),e("div",null,[e("label",L,i(t.$t("auth.email")),1),e("div",U,[w(e("input",{id:"email","onUpdate:modelValue":s[2]||(s[2]=r=>o.email=r),type:"email",required:"",class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm"},null,512),[[g,o.email]])])]),e("div",null,[e("label",D,i(t.$t("auth.password")),1),e("div",J,[w(e("input",{id:"password","onUpdate:modelValue":s[3]||(s[3]=r=>o.password=r),type:"password",required:"",class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm"},null,512),[[g,o.password]])])]),a.value?h("",!0):(c(),u("div",I,[e("label",R,i(t.$t("auth.confirmPassword")),1),e("div",F,[w(e("input",{id:"confirmPassword","onUpdate:modelValue":s[4]||(s[4]=r=>o.confirmPassword=r),type:"password",required:"",class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm"},null,512),[[g,o.confirmPassword]])])])),e("div",null,[e("button",{type:"submit",class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:p.value},[p.value?(c(),u("span",K,s[6]||(s[6]=[e("svg",{class:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):h("",!0),_(" "+i(p.value?t.$t("auth.loading"):a.value?t.$t("auth.login"):t.$t("auth.register")),1)],8,G)])],32),e("div",Q,[e("button",{onClick:y,class:"text-sm text-teal-600 hover:text-teal-500"},i(a.value?t.$t("auth.noAccount"):t.$t("auth.alreadyHaveAccount")),1)]),s[7]||(s[7]=e("div",{class:"mt-6 text-center text-sm text-gray-500"},[e("p",null,"Тестовые учетные данные:"),e("p",null,"Email: test@example.com"),e("p",null,"Пароль: test123")],-1))])])]))}});export{X as default};
